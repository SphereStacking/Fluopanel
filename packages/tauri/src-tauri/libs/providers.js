import{invoke as h}from"@tauri-apps/api/core";import{listen as P}from"@tauri-apps/api/event";function S(){let t=null,r=new Set,n=null,e=new Set,o=new Map,l=async()=>{t||(t=await P("aerospace-workspace-changed",i=>{r.forEach(u=>u(i.payload))}))},m=async()=>{n||(n=await P("aerospace-focus-changed",i=>{e.forEach(u=>u(i.payload))}))};return{async get(){return this.getWorkspaces()},async getWorkspaces(){return h("aerospace_get_workspaces")},async getFocusedWorkspace(){return h("aerospace_get_focused_workspace")},async focusWorkspace(i){return h("aerospace_focus_workspace",{id:i})},async getAppIcon(i){if(o.has(i))return{app:i,icon:o.get(i)??null};let u=await h("get_app_icon",{appName:i});return o.set(i,u.icon),u},async getAppIcons(i){let u=i.filter(f=>!o.has(f));return u.length>0&&(await h("get_app_icons",{appNames:u})).forEach(w=>o.set(w.app,w.icon)),i.map(f=>({app:f,icon:o.get(f)??null}))},subscribe(i){return this.onWorkspaceChange(i)},onWorkspaceChange(i){return r.add(i),l(),()=>{r.delete(i),r.size===0&&t&&(t(),t=null)}},onFocusChange(i){return e.add(i),m(),()=>{e.delete(i),e.size===0&&n&&(n(),n=null)}}}}import{invoke as W}from"@tauri-apps/api/core";import{listen as j}from"@tauri-apps/api/event";function C(){let t=null,r=new Set,n=async()=>{t||(t=await j("battery-changed",e=>{r.forEach(o=>o(e.payload))}))};return{async get(){return this.getBattery()},async getBattery(){return W("get_battery_info")},subscribe(e){return this.onBatteryChange(e)},onBatteryChange(e){return r.add(e),n(),()=>{r.delete(e),r.size===0&&t&&(t(),t=null)}}}}import{invoke as R}from"@tauri-apps/api/core";import{listen as V}from"@tauri-apps/api/event";function M(){let t=null,r=new Set,n=async()=>{t||(t=await V("cpu-changed",e=>{r.forEach(o=>o(e.payload))}))};return{async get(){return this.getCpu()},async getCpu(){return R("get_cpu_info")},subscribe(e){return this.onCpuChange(e)},onCpuChange(e){return r.add(e),n(),()=>{r.delete(e),r.size===0&&t&&(t(),t=null)}}}}import{invoke as q}from"@tauri-apps/api/core";import{listen as J}from"@tauri-apps/api/event";function x(){let t=null,r=new Set,n=async()=>{t||(t=await J("memory-changed",e=>{r.forEach(o=>o(e.payload))}))};return{async get(){return this.getMemory()},async getMemory(){return q("get_memory_info")},subscribe(e){return this.onMemoryChange(e)},onMemoryChange(e){return r.add(e),n(),()=>{r.delete(e),r.size===0&&t&&(t(),t=null)}}}}import{invoke as X}from"@tauri-apps/api/core";import{listen as G}from"@tauri-apps/api/event";function A(){let t=null,r=new Set,n=async()=>{t||(t=await G("network-changed",e=>{r.forEach(o=>o(e.payload))}))};return{async get(){return this.getNetwork()},async getNetwork(){return X("get_network_info")},subscribe(e){return this.onNetworkChange(e)},onNetworkChange(e){return r.add(e),n(),()=>{r.delete(e),r.size===0&&t&&(t(),t=null)}}}}function T(){let t=(n,e="HH:mm")=>{let o=i=>i.toString().padStart(2,"0"),l={YYYY:n.getFullYear().toString(),YY:n.getFullYear().toString().slice(-2),MM:o(n.getMonth()+1),M:(n.getMonth()+1).toString(),DD:o(n.getDate()),D:n.getDate().toString(),HH:o(n.getHours()),H:n.getHours().toString(),hh:o(n.getHours()%12||12),h:(n.getHours()%12||12).toString(),mm:o(n.getMinutes()),m:n.getMinutes().toString(),ss:o(n.getSeconds()),s:n.getSeconds().toString(),A:n.getHours()<12?"AM":"PM",a:n.getHours()<12?"am":"pm",ddd:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][n.getDay()],dddd:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][n.getDay()]},m=e;for(let[i,u]of Object.entries(l))m=m.replace(new RegExp(i,"g"),u);return m},r="HH:mm";return{async get(){return this.getDate(r)},getDate(n){let e=new Date,o=n??r;return{timestamp:e.getTime(),formatted:t(e,o)}},subscribe(n){return this.startPolling(n)},startPolling(n,e=6e4){let o=()=>{n(this.getDate(r))};o();let l=setInterval(o,e);return()=>{clearInterval(l)}}}}import{invoke as d}from"@tauri-apps/api/core";import{listen as K}from"@tauri-apps/api/event";function I(){let t=null,r=new Set,n=async()=>{t||(t=await K("media-changed",e=>{r.forEach(o=>o(e.payload))}))};return{async get(){return this.getMedia()},async getMedia(){return d("get_media_info")},subscribe(e){return this.onMediaChange(e)},onMediaChange(e){return r.add(e),n(),()=>{r.delete(e),r.size===0&&t&&(t(),t=null)}},async play(){return d("media_play")},async pause(){return d("media_pause")},async next(){return d("media_next")},async previous(){return d("media_previous")}}}import{invoke as y}from"@tauri-apps/api/core";import{listen as Q}from"@tauri-apps/api/event";function D(){let t=null,r=new Set,n=async()=>{t||(t=await Q("volume-changed",e=>{r.forEach(o=>o(e.payload))}))};return{async get(){return this.getVolume()},async getVolume(){return y("get_volume_info")},subscribe(e){return this.onVolumeChange(e)},onVolumeChange(e){return r.add(e),n(),()=>{r.delete(e),r.size===0&&t&&(t(),t=null)}},async setVolume(e){return y("set_volume",{level:Math.max(0,Math.min(100,e))})},async mute(){return y("set_mute",{muted:!0})},async unmute(){return y("set_mute",{muted:!1})},async toggleMute(){return y("toggle_mute")}}}import{invoke as Z}from"@tauri-apps/api/core";import{listen as ee}from"@tauri-apps/api/event";function F(){let t=null,r=new Set,n=async()=>{t||(t=await ee("active-app-changed",e=>{r.forEach(o=>o(e.payload))}))};return{async get(){return this.getActiveApp()},async getActiveApp(){return Z("get_active_app_info")},subscribe(e){return this.onActiveAppChange(e)},onActiveAppChange(e){return r.add(e),n(),()=>{r.delete(e),r.size===0&&t&&(t(),t=null)}}}}import{invoke as te}from"@tauri-apps/api/core";import{listen as re}from"@tauri-apps/api/event";function B(){let t=null,r=new Set,n=async()=>{t||(t=await re("disk-changed",e=>{r.forEach(o=>o(e.payload))}))};return{async get(){return this.getDisks()},async getDisks(){return te("get_disk_info")},async getDisk(e="/"){let o=await this.getDisks();return o.find(l=>l.mountPoint===e)??o[0]},subscribe(e){return this.onDiskChange(e)},onDiskChange(e){return r.add(e),n(),()=>{r.delete(e),r.size===0&&t&&(t(),t=null)}}}}import{invoke as E}from"@tauri-apps/api/core";import{listen as ne}from"@tauri-apps/api/event";function z(){let t=null,r=new Set,n=async()=>{t||(t=await ne("brightness-changed",e=>{r.forEach(o=>o(e.payload))}))};return{async get(){return this.getBrightness()},async getBrightness(){return E("get_brightness_info")},subscribe(e){return this.onBrightnessChange(e)},onBrightnessChange(e){return r.add(e),n(),()=>{r.delete(e),r.size===0&&t&&(t(),t=null)}},async setBrightness(e){return E("set_brightness",{level:Math.max(0,Math.min(100,e))/100})}}}import{invoke as Y}from"@tauri-apps/api/core";import{listen as oe}from"@tauri-apps/api/event";function H(){let t=null,r=new Set,n=async()=>{t||(t=await oe("bluetooth-changed",e=>{r.forEach(o=>o(e.payload))}))};return{async get(){return this.getBluetooth()},async getBluetooth(){return Y("get_bluetooth_info")},subscribe(e){return this.onBluetoothChange(e)},onBluetoothChange(e){return r.add(e),n(),()=>{r.delete(e),r.size===0&&t&&(t(),t=null)}},async toggle(){return Y("toggle_bluetooth")}}}var v="http://localhost:26538",ae="fluopanel",b="http://localhost:9863";function L(){let t=null,r=new Set,n={playing:!1},e=0,o=null,l=null,m=3,i=async()=>{try{let a=await fetch(`${v}/auth/${ae}`,{method:"POST"});return a.ok?(await a.json()).accessToken:null}catch{return null}},u=async()=>o||(o=await i(),o),f=async()=>{if(l)return l;try{let a=new AbortController,s=setTimeout(()=>a.abort(),500),c=await fetch(`${b}/query`,{signal:a.signal});if(clearTimeout(s),c.ok)return l="ytm","ytm"}catch{}try{if(await u())return l="pear","pear"}catch{}return null},w=async()=>{try{let a=await u();if(!a)throw new Error("No token");let s=new AbortController,c=setTimeout(()=>s.abort(),500),p=await fetch(`${v}/api/v1/song-info`,{signal:s.signal,headers:{Authorization:`Bearer ${a}`}});if(clearTimeout(c),p.status===401)throw o=null,new Error("Unauthorized");if(!p.ok)throw new Error("Not available");let g=await p.json();return{playing:!g.isPaused,title:g.title,artist:g.artist,album:g.album,duration:g.songDuration,position:g.elapsedSeconds,artworkUrl:g.imageSrc}}catch{return null}},$=async()=>{try{let a=new AbortController,s=setTimeout(()=>a.abort(),500),c=await fetch(`${b}/query`,{signal:a.signal});if(clearTimeout(s),!c.ok)throw new Error("Not available");let p=await c.json();return p.track?.title?{playing:p.player?.trackState===1,title:p.track.title,artist:p.track.author,album:p.track.album,duration:p.track.duration,position:p.player?.videoProgress,artworkUrl:p.track.cover}:{playing:!1}}catch{return null}},_=async()=>{let a=await f(),s=null;return a==="ytm"?s=await $():a==="pear"&&(s=await w()),s?e=0:(e++,e>=m&&(l=null)),s},O=async a=>{try{let s=await u();if(!s)return;await fetch(`${v}/api/v1/${a}`,{method:"POST",headers:{Authorization:`Bearer ${s}`}})}catch{}},N=async a=>{try{await fetch(`${b}/query`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:a})})}catch{}},k=async(a,s)=>{let c=await f();c==="ytm"?await N(s):c==="pear"&&await O(a)},U=(a,s)=>a.playing!==s.playing||a.title!==s.title||a.artist!==s.artist||a.album!==s.album;return{async get(){return this.getInfo()},async getInfo(){let a=await _();return a&&(n=a),n},subscribe(a){return r.add(a),e=0,t||(t=setInterval(async()=>{if(e>=m){t&&(clearInterval(t),t=null);return}let s=await _();s&&U(s,n)&&(n=s,r.forEach(c=>c(s)))},3e3)),()=>{r.delete(a),r.size===0&&t&&(clearInterval(t),t=null,e=0)}},async toggle(){await k("toggle-play","track-pause")},async next(){await k("next","track-next")},async previous(){await k("previous","track-previous")},async seek(a){let s=await f();if(s==="ytm")try{await fetch(`${b}/query`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:"player-seek-to",value:Math.floor(a)})})}catch{}else if(s==="pear")try{let c=await u();if(!c)return;await fetch(`${v}/api/v1/seek-to`,{method:"POST",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"},body:JSON.stringify({seconds:Math.floor(a)})})}catch{}},async launch(){if(!window.__TAURI__){console.error("[YouTubeMusic] Tauri API not available");return}try{await window.__TAURI__.core.invoke("execute_shell",{command:'open -a "YouTube Music"'})}catch(a){console.error("[YouTubeMusic] Failed to launch app:",a);try{await window.__TAURI__.core.invoke("execute_shell",{command:'open "https://music.youtube.com"'})}catch(s){console.error("[YouTubeMusic] Fallback also failed:",s)}}}}}function et(){return{aerospace:S(),battery:C(),cpu:M(),memory:x(),network:A(),date:T(),media:I(),volume:D(),activeApp:F(),disk:B(),brightness:z(),bluetooth:H(),youtubeMusic:L()}}export{F as createActiveAppProvider,S as createAerospaceProvider,C as createBatteryProvider,H as createBluetoothProvider,z as createBrightnessProvider,M as createCpuProvider,T as createDateProvider,B as createDiskProvider,I as createMediaProvider,x as createMemoryProvider,A as createNetworkProvider,et as createProviders,D as createVolumeProvider,L as createYouTubeMusicProvider};
